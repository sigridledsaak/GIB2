{% extends "layout.html" %}
{% block content %}
    <script src='static/leaflet.js'></script>
    <div class="row">
        <div class="col-12">
            <div id='map'></div>
            <script src='static/leaflet.js'></script>
        </div>
    </div>
    <div id="filterEvent" class="filterEvent">
        <button class="openbtn" onclick="openNav()">☰ Search Events</button>
    </div>
    <div id="sidebarSearch" class="sidebar" style="margin-top: 3rem">
        <h3 style="margin-left: 4%">Search Events</h3>
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
        <form name="userInput" style="margin-left: 4%" method="post" action="{{ url_for('home') }}">
            <h6>Date</h6>
            <input class="event-textinput" type="date" name="date" placeholder="On Date" />
            <h6>Time </h6>
            <input class="event-textinput" type="time" name="time" placeholder="On Time" />
            <h6>Select Categories</h6>
            <select class="event-textinput" type="text" name="category" multiple>
                {% for category in categories %}
                    <option type="checkbox" value="{{ category }}">{{ category }}</option>
                {% endfor %}
            </select>
            <h6>Max Age Limit</h6>
            <input class="event-textinput" type="number" name="ageLimit" placeholder="Age Limit" />
            <h6>Maximum Price</h6>
            <input class="event-textinput" type="number" name="ticketPrize" placeholder="Ticket Price" />
            <h6>Maximum distance (meters)</h6>
            <input class="event-textinput" type="number" name="distance" placeholder="Max distance from your location">
            <br>
            <p>Velg hvor avstanden skal måles fra</p>
            <input id="pos" class="radio" type="radio" name="pos" value="" onclick="getCurrPosition()"> From your current position<br>
            <input id="markpos" class="radio" type="radio" name="pos" value="" onclick ="getMarkPosition()"> From marked position on map<br>
            <br>
            <input class="submit action-button" type="submit" name="submit" value="Search">
            <p></p>
            <p></p>
            <br>
            <p></p>
            <p></p>
        </form>
    </div>
    {% for i in range(0,latlong|length)%}
        <script>
            try {
                pos = ({{ latlong[i] }});
                var lat = pos[0];
                var long = pos[1];
                console.log([lat,long]);
                var category = '{{ events[i].category_name }}';
                var title = '{{ events[i].title }}';
                var starttime ='{{ events[i].startdate.time() }}';
                var startdate ='{{ events[i].startdate.date() }}';
                var vname = '{{ events[i].venueName}}';
                var vaddress='{{ events[i].venueAddress }}';
                var furl = '{{ events[i].facebookEventUrl }}';
                console.log(title);
                console.log(category);
                console.log('furl'+ furl);
                addMarker([lat,long],title,category,starttime,startdate,furl,vname,vaddress);
        }catch (e){
                console.log(e);
            }

        </script>
    {% endfor %}
    <script>
        function openNav() {
          document.getElementById("sidebarSearch").style.width = "400px";
          document.getElementById("filterEvent").style.marginLeft = "-400px";
        }

        function closeNav() {
          document.getElementById("sidebarSearch").style.width = "0";
          document.getElementById("filterEvent").style.marginLeft= "0";
        }
    </script>
    <script>
    var starpin = new Icon({iconUrl: 'https://cdn2.iconfinder.com/data/icons/map-locations-filled-pixel-perfect/64/pin-map-location-28-512.png'});
        if ('({{ lat_user }})' != 'None') {
            var lat_user = ({{ lat_user }});
            var long_user = ({{ long_user }});

            var marker = L.marker([lat_user, long_user]).addTo(map);
            marker.setIcon(starpin);
        }
        if (({{ distance }}) != 'None') {
            var dist = ({{ distance }});
            var circle = L.circle([lat_user, long_user], {
                color: 'grey',
                fillColor: 'grey',
                fillOpacity: 0.1,
                radius: dist
            }).addTo(map);
        }
        map.setView([lat_user,long_user]);
    </script>
{% endblock content %}